<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Show Clusters</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="4926f311-8333-4b18-b509-70c1d876d5eb" /><meta name="Description" content="This page explains the Clustering use case which is provided with PTV xServer .NET. It shows how geographical elements can be displayed in a clustered way." /><meta name="Microsoft.Help.ContentType" content="Samples" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">PTV xServer .NET<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html\9e985ce7-8d43-434f-82bb-260b742553c1.htm" title="PTV xServer .NET" tocid="roottoc">PTV xServer .NET</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/a5bc5d46-5eb8-4b50-be53-1ffa3f7bc7f4.htm" title="How To ..." tocid="a5bc5d46-5eb8-4b50-be53-1ffa3f7bc7f4">How To ...</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/5ff21e55-6f37-451d-acae-9321ca31836d.htm" title="XServer Connection" tocid="5ff21e55-6f37-451d-acae-9321ca31836d">XServer Connection</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/714dc4ba-10d3-4a8d-a55d-6210630ff6eb.htm" title="Show Here Satellite View" tocid="714dc4ba-10d3-4a8d-a55d-6210630ff6eb">Show Here Satellite View</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="../html/4926f311-8333-4b18-b509-70c1d876d5eb.htm" title="Show Clusters" tocid="4926f311-8333-4b18-b509-70c1d876d5eb">Show Clusters</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/101dba72-fb36-468b-aa99-4b9c5bbfb62f.htm" title="Add Different Shapes" tocid="101dba72-fb36-468b-aa99-4b9c5bbfb62f">Add Different Shapes</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/e9f559c7-394c-4858-8a40-4744d2fc7200.htm" title="Integrate an additional WPF map" tocid="e9f559c7-394c-4858-8a40-4744d2fc7200">Integrate an additional WPF map</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/6b437145-f3ed-4267-a3fc-e71737e6db65.htm" title="Add a GeoRSS Layer" tocid="6b437145-f3ed-4267-a3fc-e71737e6db65">Add a GeoRSS Layer</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/d705537f-f7fe-435c-bd80-d4d399ee4410.htm" title="Show Map&amp;Market Data" tocid="d705537f-f7fe-435c-bd80-d4d399ee4410">Show Map&amp;Market Data</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/427ab62e-f02d-4e92-9c26-31e0f89d49c5.htm" title="Show a Shape File Content" tocid="427ab62e-f02d-4e92-9c26-31e0f89d49c5">Show a Shape File Content</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/2f6d7ed1-b136-44dc-97c1-3f2c640c2134.htm" title="Add a WMS Layer" tocid="2f6d7ed1-b136-44dc-97c1-3f2c640c2134">Add a WMS Layer</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/fccd9937-aa04-4803-936d-7796cb966963.htm" title="Selection" tocid="fccd9937-aa04-4803-936d-7796cb966963">Selection</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/90fd0772-df3b-473b-a305-6ee939193c7f.htm" title="Apply a UI Theme" tocid="90fd0772-df3b-473b-a305-6ee939193c7f">Apply a UI Theme</a></div><div class="toclevel2" data-toclevel="2"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/fe48cb51-c6ce-487e-b4c0-168537c184c3.htm" title="Geocode an Address" tocid="fe48cb51-c6ce-487e-b4c0-168537c184c3">Geocode an Address</a></div><div class="toclevel2" data-toclevel="2"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/e7c12cc4-3819-470e-867a-b521bee43cf0.htm" title="Elementary Routing" tocid="e7c12cc4-3819-470e-867a-b521bee43cf0">Elementary Routing</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/e4c416a0-9573-4df8-b733-3bf72539ef0f.htm" title="Drag&amp;Drop Routing" tocid="e4c416a0-9573-4df8-b733-3bf72539ef0f">Drag&amp;Drop Routing</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/34f6b520-454f-4a6a-b0ae-00fc77da512b.htm" title="Tour Planning" tocid="34f6b520-454f-4a6a-b0ae-00fc77da512b">Tour Planning</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/eb8e522c-5ed2-4481-820f-bfd74ee2aeb8.htm" title="Use the Map Gadgets" tocid="eb8e522c-5ed2-4481-820f-bfd74ee2aeb8">Use the Map Gadgets</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/fdaa5363-b092-43cc-950e-6f120dee0d92.htm" title="Set the Map Location" tocid="fdaa5363-b092-43cc-950e-6f120dee0d92">Set the Map Location</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/b55f5d50-a421-4951-bc01-d5fb85c94f54.htm" title="Add an XMapServer Layer" tocid="b55f5d50-a421-4951-bc01-d5fb85c94f54">Add an XMapServer Layer</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/91617b6b-1086-4c05-a1ce-4c64f8bc7dcd.htm" title="Add a Custom Layer" tocid="91617b6b-1086-4c05-a1ce-4c64f8bc7dcd">Add a Custom Layer</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/88521cb3-0770-4f9c-9e47-74b6ea02b6eb.htm" title="Build an ActiveX Control" tocid="88521cb3-0770-4f9c-9e47-74b6ea02b6eb">Build an ActiveX Control</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/1cdf95ec-699c-4d92-bc98-df93503e5a4e.htm" title="Build a C++/MFC application" tocid="1cdf95ec-699c-4d92-bc98-df93503e5a4e">Build a C++/MFC application</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>Show Clusters</h1></td></tr></table><span class="introStyle"></span> <div class="introduction"><p>This page explains the <span class="term">Clustering</span> use case which is provided with PTV xServer .NET.
        It shows how geographical elements can be displayed in a clustered way.
      </p><p>This page contains the following sections:</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#ImportantConcepts">Important concepts</a></li><li class="outlineSectionEntry"><a href="#UseCases">Use case manual</a></li><li class="outlineSectionEntry"><a href="#seeAlsoSection">See Also</a></li></ul></div><div class="collapsibleAreaRegion" id="ImportantConcepts"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Important concepts</span></div><div id="ID1RBSection" class="collapsibleSection"><p>
          The <span class="term">Clustering</span> use case uses a simple <a href="T_Ptv_XServer_Controls_Map_Layers_BaseLayer.htm">BaseLayer</a>
          to display earthquakes from a CSV file with clustering (<a href="T_Ptv_XServer_Controls_Map_Tools_TileBasedPointClusterer_1.htm">TileBasedPointClusterer<span id="LST6779A3BA_0"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST6779A3BA_0?cs=&lt;|vb=(Of |cpp=&lt;|nu=(|fs=&lt;'");</script>T<span id="LST6779A3BA_1"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST6779A3BA_1?cs=&gt;|vb=)|cpp=&gt;|nu=)|fs=&gt;");</script></a>).
        </p><h4 class="subHeading" id="SectionCreateLayer">Creating and configuring a layer instance</h4><div class="subsection"><p>
              A <a href="T_Ptv_XServer_Controls_Map_Layers_BaseLayer.htm">BaseLayer</a> instance is used as the container for the clustered elements
              of this use case. More details about the <a href="T_Ptv_XServer_Controls_Map_Tools_TileBasedPointClusterer_1.htm">TileBasedPointClusterer<span id="LST6779A3BA_2"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST6779A3BA_2?cs=&lt;|vb=(Of |cpp=&lt;|nu=(|fs=&lt;'");</script>T<span id="LST6779A3BA_3"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST6779A3BA_3?cs=&gt;|vb=)|cpp=&gt;|nu=)|fs=&gt;");</script></a>
              will be discussed in the sections below.
            </p><p>
              First, a layer is created, configured and added to the map. The following code shows how to
            </p><ul><li><p>add a <a href="T_Ptv_XServer_Controls_Map_Layers_BaseLayer.htm">BaseLayer</a></p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAABDABACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAABDABACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAABDABACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAABDABACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-comment">// Start the longtime reading of geo data in a separate thread.</span>
<span class="highlight-keyword">var</span> clusters = <span class="highlight-keyword">await</span> Task.Factory.StartNew(LocalizedWikiDemo.ReadCSVFile);

<span class="highlight-comment">// Creates a clustering layer.</span>
<span class="highlight-keyword">var</span> clusteringLayer = <span class="highlight-keyword">new</span> BaseLayer(<span class="highlight-literal">"Clustering"</span>)
{
    CanvasCategories = <span class="highlight-keyword">new</span>[] { CanvasCategory.Content },
    CanvasFactories = <span class="highlight-keyword">new</span> BaseLayer.CanvasFactoryDelegate[] { map =&gt; <span class="highlight-keyword">new</span> LocalizedWikiDemo(map, clusters) }
};

<span class="highlight-comment">// Adds the created clustering layer to the WpfMap.</span>
wpfMap.Layers.Add(clusteringLayer);</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAABDABACAAA");</script></li><li><p>and zoom to a specific location</p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAAADABACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAAADABACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAAADABACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAAADABACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">wpfMap.SetMapLocation(<span class="highlight-keyword">new</span> Point(<span class="highlight-number">8.4</span>, <span class="highlight-number">49</span>), <span class="highlight-number">10</span>);</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAADABACAAA");</script></li></ul><p>
              Loading of the demo data and instantiation of the <a href="T_Ptv_XServer_Controls_Map_Tools_TileBasedPointClusterer_1.htm">TileBasedPointClusterer<span id="LST6779A3BA_4"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST6779A3BA_4?cs=&lt;|vb=(Of |cpp=&lt;|nu=(|fs=&lt;'");</script>T<span id="LST6779A3BA_5"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST6779A3BA_5?cs=&gt;|vb=)|cpp=&gt;|nu=)|fs=&gt;");</script></a>
              is processed by the <a href="T_Ptv_XServer_Demo_Clustering_LocalizedWikiDemo.htm">LocalizedWikiDemo</a> class.
            </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EABABACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EABABACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EABABACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EABABACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-comment">/// &lt;summary&gt; Initializes a new instance of the &lt;see cref="LocalizedWikiDemo"/&gt; class. Reads in the earthquakes</span>
<span class="highlight-comment">/// from a file and displays them on the map. &lt;/summary&gt;</span>
<span class="highlight-comment">/// &lt;param name="mapView"&gt; The map to be used for display. &lt;/param&gt;</span>
<span class="highlight-comment">/// &lt;param name="clusterer"&gt; The clusterer containing the clusters. &lt;/param&gt;</span>
<span class="highlight-keyword">public</span> LocalizedWikiDemo(MapView mapView, TileBasedPointClusterer&lt;Post&gt; clusterer)
    : <span class="highlight-keyword">base</span>(mapView)
{
    adjustTransform = <span class="highlight-keyword">new</span> ScaleTransform();
    <span class="highlight-keyword">this</span>.clusterer = clusterer;

    logicalScaleFactor = <span class="highlight-number">0.65</span>;
    UpdateBalls();
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EABABACAAA");</script><p>
              The earthquake data is loaded from a CSV file before it is processed by the clusterer.
              See the <a href="#SectionClusterer">clusterer section</a> for usage details.
            </p></div><h4 class="subHeading" id="SectionClusterer">Using the clusterer</h4><div class="subsection"><p>
              After the creation of a <a href="T_Ptv_XServer_Controls_Map_Tools_TileBasedPointClusterer_1.htm">TileBasedPointClusterer<span id="LST6779A3BA_6"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST6779A3BA_6?cs=&lt;|vb=(Of |cpp=&lt;|nu=(|fs=&lt;'");</script>T<span id="LST6779A3BA_7"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST6779A3BA_7?cs=&gt;|vb=)|cpp=&gt;|nu=)|fs=&gt;");</script></a> instance
              (see the <a href="#SectionCreateLayer">previous section</a>), the clusterer has to be initialized with the data to cluster.
              In the demo sample, earthquake locations are loaded from a CSV file.
            </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAGAAACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAGAAACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAGAAACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAGAAACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-comment">/// &lt;summary&gt; Reads the earthquakes from a csv file and adds them to a clusterer. The clusterer then groups</span>
<span class="highlight-comment">/// them to clusters. &lt;/summary&gt;</span>
<span class="highlight-comment">/// &lt;returns&gt; Documentation in progress... &lt;/returns&gt;</span>
<span class="highlight-keyword">public</span> <span class="highlight-keyword">static</span> TileBasedPointClusterer&lt;Post&gt; ReadCSVFile()
{
    <span class="highlight-keyword">var</span> clusterer = <span class="highlight-keyword">new</span> TileBasedPointClusterer&lt;Post&gt;(MapView.LogicalSize, <span class="highlight-number">0</span>, <span class="highlight-number">19</span>);
    <span class="highlight-keyword">var</span> filePath = System.IO.Path.Combine(AppDomain.CurrentDomain.BaseDirectory, <span class="highlight-literal">@"Resources\ClusterData"</span>) + <span class="highlight-literal">@"\wikilocations.csv"</span>;
    <span class="highlight-keyword">using</span> (<span class="highlight-keyword">var</span> reader = <span class="highlight-keyword">new</span> CsvFileReader(filePath, (<span class="highlight-keyword">char</span>) <span class="highlight-number">0x09</span>))
    {
        <span class="highlight-keyword">var</span> row = <span class="highlight-keyword">new</span> CsvRow();
        <span class="highlight-keyword">while</span> (reader.ReadRow(row))
        {
            <span class="highlight-keyword">if</span> (row.Count &lt; <span class="highlight-number">3</span>)
                <span class="highlight-keyword">continue</span>;

            <span class="highlight-keyword">double</span> x, y;
            <span class="highlight-keyword">bool</span> parsed = Double.TryParse(row[<span class="highlight-number">2</span>], NumberStyles.Float, CultureInfo.InvariantCulture, <span class="highlight-keyword">out</span> x);
            x = parsed ? x : Double.NaN;
            parsed = Double.TryParse(row[<span class="highlight-number">1</span>], NumberStyles.Float, CultureInfo.InvariantCulture, <span class="highlight-keyword">out</span> y);
            y = parsed ? y : Double.NaN;
            <span class="highlight-keyword">var</span> post = <span class="highlight-keyword">new</span> Post {Title = row[<span class="highlight-number">0</span>], Location = <span class="highlight-keyword">new</span> Point(x, y)};
            post.TransformedLocation = GeoTransform.WGSToPtvMercator(post.Location);
            clusterer.AddPoint(post.TransformedLocation.X, post.TransformedLocation.Y, <span class="highlight-number">1</span>, post);
        }
    }

    <span class="highlight-preprocessor">#region</span> doc:clusterer.Cluster method call
    clusterer.Cluster();
    <span class="highlight-keyword">return</span> clusterer;
    <span class="highlight-preprocessor">#endregion</span> <span class="highlight-comment">//doc:clusterer.Cluster method call</span>
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAGAAACAAA");</script><p>
              Note the call of the <a href="M_Ptv_XServer_Controls_Map_Tools_TileBasedPointClusterer_1_Cluster.htm">Cluster<span id="LST6779A3BA_8"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST6779A3BA_8?cs=()|vb=|cpp=()|nu=()|fs=()");</script></a> method
              after the data initialization.
            </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAEAAACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAEAAACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAEAAACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAEAAACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">clusterer.Cluster();
<span class="highlight-keyword">return</span> clusterer;</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAEAAACAAA");</script><p>
              Finally, after initialization and on each <a href="E_Ptv_XServer_Controls_Map_MapView_ViewportEndChanged.htm">ViewportEndChanged</a> event,
              clustering has to be recalculated for the current map region and zoom level.
            </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EACAAACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EACAAACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EACAAACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EACAAACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-comment">/// &lt;summary&gt; Event handler for a change of the map viewport. Renders a ball for each of the earthquake</span>
<span class="highlight-comment">/// clusters in the current map display section. &lt;/summary&gt;</span>
<span class="highlight-keyword">private</span> <span class="highlight-keyword">void</span> UpdateBalls()
{
    Children.Clear();

    MapRectangle rect = MapView.FinalEnvelope;
    <span class="highlight-keyword">var</span> clusters = clusterer.GetClusters(rect.West, rect.South, rect.East, rect.North, (<span class="highlight-keyword">int</span>)MapView.FinalZoom + <span class="highlight-number">1</span>);
    <span class="highlight-keyword">foreach</span> (<span class="highlight-keyword">var</span> cluster <span class="highlight-keyword">in</span> clusters)
    {
        <span class="highlight-keyword">var</span> toolTip = <span class="highlight-literal">""</span>;
        <span class="highlight-keyword">var</span> point = <span class="highlight-keyword">new</span> Point(cluster.CentroidX, cluster.CentroidY);

        <span class="highlight-keyword">if</span> (cluster.Tags.Count &lt;= <span class="highlight-number">25</span>)
        {
            toolTip = cluster.Tags.Aggregate(toolTip, (current, post) =&gt; current + (post.Title + <span class="highlight-literal">" "</span> + post.Location.Y + <span class="highlight-literal">" / "</span> + post.Location.X + <span class="highlight-literal">"\n"</span>));
            toolTip = toolTip.Substring(<span class="highlight-number">0</span>, toolTip.Length - <span class="highlight-number">1</span>);
        }
        <span class="highlight-keyword">else</span>
        {
            toolTip = cluster.Tags.Count + <span class="highlight-literal">" objects."</span>;
        }

        renderBall(toolTip, point, cluster.Tags.Count);
    }
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EACAAACAAA");</script><p>
              The source code creates <a href="T_Ptv_XServer_Controls_Map_Symbols_Ball.htm">Ball</a> symbols
              (see the <a href="101dba72-fb36-468b-aa99-4b9c5bbfb62f.htm">Different Shapes topic</a>) which
              represent the clustered earthquake elements in aggregated sizes and colors depending on their "relative danger" values from the CSV file.
            </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAAAAACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAAAAACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAAAAACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAAAAACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-comment">/// &lt;summary&gt; Renders a ball for a certain earthquake cluster. &lt;/summary&gt;</span>
<span class="highlight-comment">/// &lt;param name="toolTip"&gt; Tooltip to be shown for the cluster. &lt;/param&gt;</span>
<span class="highlight-comment">/// &lt;param name="location"&gt; Location of the cluster. &lt;/param&gt;</span>
<span class="highlight-comment">/// &lt;param name="clusterSize"&gt; Cluster size e.g. number of objects contained in the cluster. &lt;/param&gt;</span>
<span class="highlight-keyword">private</span> <span class="highlight-keyword">void</span> renderBall(<span class="highlight-keyword">string</span> toolTip, Point location, <span class="highlight-keyword">int</span> clusterSize)
{
    <span class="highlight-comment">// create button and set pin template</span>
    <span class="highlight-keyword">var</span> ball = <span class="highlight-keyword">new</span> Ball
    {
        <span class="highlight-comment">// scale around center</span>
        RenderTransformOrigin = <span class="highlight-keyword">new</span> Point(.<span class="highlight-number">5</span>, .<span class="highlight-number">5</span>),

        <span class="highlight-comment">// set render transform for power-law scaling</span>
        RenderTransform = adjustTransform,
    };

    <span class="highlight-comment">// calculate a value between 0 and 1 and use it for a blend color</span>
    <span class="highlight-keyword">double</span> log10 = Math.Log10(clusterSize);
    <span class="highlight-comment">//double relativeDanger = Math.Max(0, Math.Min(1, (magnitude - 2.5) / 4));</span>
    <span class="highlight-keyword">double</span> relativeDanger = Math.Max(<span class="highlight-number">0</span>, Math.Min(<span class="highlight-number">1</span>, (log10) / <span class="highlight-number">4</span>));<span class="highlight-comment">//Math.Max(0, Math.Min(1, ((double)clusterSize) / 50));</span>
    ball.Color = Colors.Red;
    ball.Color = GeoRSS.ColorBlend.Danger.GetColor((<span class="highlight-keyword">float</span>)relativeDanger);

    <span class="highlight-comment">// set size by magnitude</span>
    ball.Height = Math.Max(<span class="highlight-number">3</span>, relativeDanger * <span class="highlight-number">50</span>);<span class="highlight-comment">//System.Math.Min(System.Math.Max(clusterSize + 3, 5), 50);</span>
    ball.Width = ball.Height;<span class="highlight-comment">//System.Math.Min(System.Math.Max(clusterSize + 3, 5), 50);</span>

    <span class="highlight-comment">// set tool tip information</span>
    ToolTipService.SetToolTip(ball, toolTip);

    <span class="highlight-comment">// set position and add to canvas (invert y-ordinate)</span>
    <span class="highlight-comment">// set lower right (pin-tip) as position</span>
    SetLeft(ball, location.X - ball.Width / <span class="highlight-number">2</span>);
    SetTop(ball, -(location.Y + ball.Height / <span class="highlight-number">2</span>));
    Children.Add(ball);
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAAAACAAA");</script></div></div><div class="collapsibleAreaRegion" id="UseCases"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Use case manual</span></div><div id="ID2RBSection" class="collapsibleSection"><p>This section describes how to use the <span class="term">Clustering</span> in the Demo Center sample.</p><h4 class="subHeading" id="UseCase1">How to display the Clustering on the map</h4><div class="subsection"><p>
              The Clustering sample shows how to display elements in a clustered way. When starting the demo application, 
              the clustered elements can be seen, if the corresponding layer is activated via checkbox in the 
              <span class="term">Clustering</span> expander.
            </p><div class="mediaCenter"><img alt="Clustering" src="../media/Clustering.png" /><div class="caption">Clustering</div></div></div></div><div class="collapsibleAreaRegion" id="seeAlsoSection"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />See Also</span></div><div id="ID3RBSection" class="collapsibleSection"><h4 class="subHeading">Reference</h4><div class="seeAlsoStyle"><a href="T_Ptv_XServer_Controls_Map_Tools_TileBasedPointClusterer_1.htm">TileBasedPointClusterer<span id="LST6779A3BA_9"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST6779A3BA_9?cs=&lt;|vb=(Of |cpp=&lt;|nu=(|fs=&lt;'");</script>T<span id="LST6779A3BA_10"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST6779A3BA_10?cs=&gt;|vb=)|cpp=&gt;|nu=)|fs=&gt;");</script></a></div><div class="seeAlsoStyle"><a href="T_Ptv_XServer_Controls_Map_Layers_BaseLayer.htm">BaseLayer</a></div><h4 class="subHeading">Other Resources</h4><div class="seeAlsoStyle"><a href="101dba72-fb36-468b-aa99-4b9c5bbfb62f.htm">Different Shapes</a></div></div></div></div><div id="pageFooter" class="pageFooter">Visit our website at <a href="http://www.ptvgroup.com">www.ptvgroup.com</a> or browse to <a href="http://xserver.ptvgroup.com">xserver.ptvgroup.com</a> for the latest information on our developer components.<p>Copyright (c) PTV Group, Karlsruhe, Germany.</p><div class="feedbackLink">Send comments on this topic to
        <a id="HT_MailLink" href="mailto:developer%40ptvgroup.com?Subject=PTV xServer .NET">developer@ptvgroup.com</a></div>
        <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>