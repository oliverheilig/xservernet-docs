<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Build a C++/MFC application</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="1cdf95ec-699c-4d92-bc98-df93503e5a4e" /><meta name="Description" content="This section provides additional information about how PTV xServer .NET can be used in C++/MFC based applications." /><meta name="Microsoft.Help.ContentType" content="Samples" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">PTV xServer .NET<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html\9e985ce7-8d43-434f-82bb-260b742553c1.htm" title="PTV xServer .NET" tocid="roottoc">PTV xServer .NET</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/a5bc5d46-5eb8-4b50-be53-1ffa3f7bc7f4.htm" title="How To ..." tocid="a5bc5d46-5eb8-4b50-be53-1ffa3f7bc7f4">How To ...</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/5ff21e55-6f37-451d-acae-9321ca31836d.htm" title="XServer Connection" tocid="5ff21e55-6f37-451d-acae-9321ca31836d">XServer Connection</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/714dc4ba-10d3-4a8d-a55d-6210630ff6eb.htm" title="Show Here Satellite View" tocid="714dc4ba-10d3-4a8d-a55d-6210630ff6eb">Show Here Satellite View</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/4926f311-8333-4b18-b509-70c1d876d5eb.htm" title="Show Clusters" tocid="4926f311-8333-4b18-b509-70c1d876d5eb">Show Clusters</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/101dba72-fb36-468b-aa99-4b9c5bbfb62f.htm" title="Add Different Shapes" tocid="101dba72-fb36-468b-aa99-4b9c5bbfb62f">Add Different Shapes</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/e9f559c7-394c-4858-8a40-4744d2fc7200.htm" title="Integrate an additional WPF map" tocid="e9f559c7-394c-4858-8a40-4744d2fc7200">Integrate an additional WPF map</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/6b437145-f3ed-4267-a3fc-e71737e6db65.htm" title="Add a GeoRSS Layer" tocid="6b437145-f3ed-4267-a3fc-e71737e6db65">Add a GeoRSS Layer</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/d705537f-f7fe-435c-bd80-d4d399ee4410.htm" title="Show Map&amp;Market Data" tocid="d705537f-f7fe-435c-bd80-d4d399ee4410">Show Map&amp;Market Data</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/427ab62e-f02d-4e92-9c26-31e0f89d49c5.htm" title="Show a Shape File Content" tocid="427ab62e-f02d-4e92-9c26-31e0f89d49c5">Show a Shape File Content</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/2f6d7ed1-b136-44dc-97c1-3f2c640c2134.htm" title="Add a WMS Layer" tocid="2f6d7ed1-b136-44dc-97c1-3f2c640c2134">Add a WMS Layer</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/fccd9937-aa04-4803-936d-7796cb966963.htm" title="Selection" tocid="fccd9937-aa04-4803-936d-7796cb966963">Selection</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/90fd0772-df3b-473b-a305-6ee939193c7f.htm" title="Apply a UI Theme" tocid="90fd0772-df3b-473b-a305-6ee939193c7f">Apply a UI Theme</a></div><div class="toclevel2" data-toclevel="2"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/fe48cb51-c6ce-487e-b4c0-168537c184c3.htm" title="Geocode an Address" tocid="fe48cb51-c6ce-487e-b4c0-168537c184c3">Geocode an Address</a></div><div class="toclevel2" data-toclevel="2"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/e7c12cc4-3819-470e-867a-b521bee43cf0.htm" title="Elementary Routing" tocid="e7c12cc4-3819-470e-867a-b521bee43cf0">Elementary Routing</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/e4c416a0-9573-4df8-b733-3bf72539ef0f.htm" title="Drag&amp;Drop Routing" tocid="e4c416a0-9573-4df8-b733-3bf72539ef0f">Drag&amp;Drop Routing</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/34f6b520-454f-4a6a-b0ae-00fc77da512b.htm" title="Tour Planning" tocid="34f6b520-454f-4a6a-b0ae-00fc77da512b">Tour Planning</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/eb8e522c-5ed2-4481-820f-bfd74ee2aeb8.htm" title="Use the Map Gadgets" tocid="eb8e522c-5ed2-4481-820f-bfd74ee2aeb8">Use the Map Gadgets</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/fdaa5363-b092-43cc-950e-6f120dee0d92.htm" title="Set the Map Location" tocid="fdaa5363-b092-43cc-950e-6f120dee0d92">Set the Map Location</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/b55f5d50-a421-4951-bc01-d5fb85c94f54.htm" title="Add an XMapServer Layer" tocid="b55f5d50-a421-4951-bc01-d5fb85c94f54">Add an XMapServer Layer</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/91617b6b-1086-4c05-a1ce-4c64f8bc7dcd.htm" title="Add a Custom Layer" tocid="91617b6b-1086-4c05-a1ce-4c64f8bc7dcd">Add a Custom Layer</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/88521cb3-0770-4f9c-9e47-74b6ea02b6eb.htm" title="Build an ActiveX Control" tocid="88521cb3-0770-4f9c-9e47-74b6ea02b6eb">Build an ActiveX Control</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="../html/1cdf95ec-699c-4d92-bc98-df93503e5a4e.htm" title="Build a C++/MFC application" tocid="1cdf95ec-699c-4d92-bc98-df93503e5a4e">Build a C++/MFC application</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>Build a C++/MFC application</h1></td></tr></table><span class="introStyle"></span> <div class="introduction"><p>
        This section provides additional information about how PTV xServer .NET can be used in C++/MFC based applications. 
      </p><p>
        ActiveX is another technology allowing PTV xServer .NET to be used in various environments, when being wrapped properly. 
        Please refer to the <a href="88521cb3-0770-4f9c-9e47-74b6ea02b6eb.htm">ActiveX conceptual page</a> for more 
        information.
      </p><p>This page contains the following sections:</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#CommonLanguageRuntimeSupport">Common Language Runtime Support in C++</a></li><li class="outlineSectionEntry"><a href="#EmbeddingMapControlMfc">How to embed the Map Control in a MFC Dialog</a></li><li class="outlineSectionEntry"><a href="#GenericApproach">Generic Approach for MFC Dialogs and Views</a></li></ul></div><div class="collapsibleAreaRegion" id="CommonLanguageRuntimeSupport"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Common Language Runtime Support in C++</span></div><div id="ID1RBSection" class="collapsibleSection"><p>
            The Common Language Runtime support in Microsoft Visual Studio for C++ projects along with the C++/CLI language 
            extensions make it quite easy to incorporate .NET into C++ applications. A simple change in the project 
            settings enables C++ applications to use all the .NET based components at hand, including the powerful framework 
            components themself.
          </p><div class="mediaCenter"><img alt="Project Settings (Configuration Properties / General)" src="../media/MFC01.png" /><div class="caption">Project settings in the Configuration Properties / General tabsheet</div></div><p>
            A very simple "Hello World"-style sample looks like this:
          </p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EABACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EABACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EABACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-preprocessor">#include</span> <span class="highlight-literal">"stdafx.h"</span>

<span class="highlight-comment">// include some .NET libraries</span>
<span class="highlight-preprocessor">#using</span> &lt;System.dll&gt;
<span class="highlight-preprocessor">#using</span> &lt;System.Windows.Forms.dll&gt;

<span class="highlight-keyword">int</span> _tmain(<span class="highlight-keyword">int</span> argc, _TCHAR* argv[])
{
  <span class="highlight-comment">// create a managed string</span>
  System::String^ msg = gcnew System::String(<span class="highlight-literal">"Hello World!"</span>);

  <span class="highlight-comment">// use .NET's System.Windows.Forms.MessageBox to display a message</span>
  System::Windows::Forms::MessageBox::Show(msg);

  <span class="highlight-keyword">return</span> <span class="highlight-number">0</span>;
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EABACAAA");</script><p>
            To get familiar with C++/CLI, there are a lot of good online resources and tutorials available, providing 
            in-depth knowledge. Good reads include the book "C++/CLI in Action", Code Project hosts a tutorial that claims to teach
            <a href="http://www.codeproject.com/Articles/19354/Quick-C-CLI-Learn-C-CLI-in-less-than-10-minutes" target="_blank">C++/CLI in less than 10 minutes</a></p></div><div class="collapsibleAreaRegion" id="EmbeddingMapControlMfc"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />How to embed the Map Control in a MFC Dialog</span></div><div id="ID2RBSection" class="collapsibleSection"><p>
            On the base of CLR support and the C++/CLI extensions it is very easy to add PTV xServer .NET's map control to a 
            MFC based dialog. Just follow these steps:
          </p><ol><li><p><strong>
                Configure the project for Common Language Runtime (CLR) support
              </strong></p><p>
                In Solution Explorer, right-click the project node, and then click Properties. In the Property Pages dialog 
                box, set the configuration (upper left) to All Configurations. Under Configuration Properties, select General. 
                In the Project Defaults section, set Common Language Runtime support to Common Language Runtime Support (/clr). 
                Under Configuration Properties, expand C/C++ and select the General node. Set Debug Information Format to Program 
                Database (/Zi). Select the Code Generation node. Set Enable Minimal Rebuild to No (/Gm-). Also set Basic Runtime 
                Checks to Default. Click OK to apply the changes.
              </p><div class="mediaCenter"><img alt="Project Settings (Configuration Properties / General)" src="../media/MFC02.png" /><div class="caption">Project settings in the Configuration Properties / General tabsheet</div></div><div class="mediaCenter"><img alt="Project Settings (C/C++ / General)" src="../media/MFC03.png" /><div class="caption">Project settings in the C/C++ / General tabsheet</div></div><div class="mediaCenter"><img alt="Project Settings (C/C++ / Code Generation)" src="../media/MFC04.png" /><div class="caption">Project settings in the C/C++ / Code Generation tabsheet</div></div></li><li><p><strong>
                Add a reference to the .NET control
              </strong></p><p>
                In Solution Explorer, right-click the project node and then click References. On the Property Page, click Add 
                New Reference, select the Browse tab and navigate to the PTV xServer .NET's lib folder. Select 
                Ptv.XServer.Controls.Map.dll, and click OK. This adds a reference in the form of a /FU compiler option so that 
                the program will compile. 
              </p></li><li><p><strong>
                Adopt Stdafx.h
              </strong></p><p>
                In Stdafx.h, find this line:
              </p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EACDAABAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EACDAABAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EACDAABAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-preprocessor">#endif</span> <span class="highlight-comment">// _AFX_NO_AFXCMN_SUPPORT</span></pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EACDAABAAA");</script><p>
                Above it, add these lines:
              </p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAADAABAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAADAABAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAADAABAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-preprocessor">#include</span> &lt;afxwinforms.h&gt;   <span class="highlight-comment">// MFC Windows Forms support</span></pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAADAABAAA");</script></li><li><p><strong>Add a placeholder to the MFC dialog box</strong></p><p>
                On the View menu, click Resource View. In Resource View, expand the Dialog folder and double-click the dialog 
                which should be added to the map. The dialog resource appears in Resource Editor. In the Toolbox, open the Dialog 
                Editor list. Drag a Static Text control to the dialog resource. The Static Text control will serve as a 
                placeholder for the WinForms Map Controls. Resize it as needed. In the Properties window, change the ID of 
                the Static Text control to IDC_MAPCTRL and change the TabStop property to True.
              </p><div class="mediaCenter"><img alt="Dialog in the Resource Editor" src="../media/MFC05.png" /><div class="caption">Placeholder for the Map Control</div></div></li><li><p><strong>
                Add code to create and initialize the managed map control
              </strong></p><p>
                First, declare the managed map control. In the dialog's header file, go to the declaration of the dialog 
                class, and add a data member for the map control in Protected scope, as follows.
              </p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAEBAABAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAEBAABAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAEBAABAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">class</span> CMFCMapDialogDlg : <span class="highlight-keyword">public</span> CDialog
{ 
  <span class="highlight-comment">// ...</span>
  <span class="highlight-comment">// Data member for the PTV xServer .NET map control</span>
  CWinFormsControl&lt;Ptv::XServer::Controls::Map::FormsMap&gt; m_mapCtrl;

<span class="highlight-comment">// ...</span></pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAEBAABAAA");</script><p>
                Next, provide an implementation for the map control. In dialog's cpp file, override DoDataExchange that was 
                generated by the MFC Application wizard (not CAboutDlg::DoDataExchange, which is in the same file), add the 
                following code to create the map control and associate it with the static place holder IDC_MAPCTRL.
              </p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EACBAABAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EACBAABAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EACBAABAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">void</span> CMFCMapDialogDlg::DoDataExchange(CDataExchange* pDX)
{
  CDialog::DoDataExchange(pDX);
  DDX_ManagedControl(pDX, IDC_MAPCTRL, m_mapCtrl);
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EACBAABAAA");</script><p>
                Finally, provide the initialization code for the map control. In dialog's cpp file, insert code in the 
                OnInitDialog method to setup a valid xMap Server URL.
              </p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAABAABAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAABAABAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAABAABAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">BOOL CMFCMapDialogDlg::OnInitDialog()
{
  <span class="highlight-comment">// ...</span>
  <span class="highlight-comment">// TODO: Add extra initialization here</span>
  m_mapCtrl-&gt;XMapUrl = gcnew System::String(<span class="highlight-literal">"https://xmap-eu-n.cloud.ptvgroup.com/xmap/ws/XMap"</span>);

  <span class="highlight-keyword">return</span> TRUE;
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAABAABAAA");</script></li><li><p><strong>
                Build and run the project
              </strong></p><p>
                In Solution Explorer, right-click the project node and then click Set as StartUp Project. On the Build 
                menu, click Build Solution. On the Debug menu, click Start without debugging. The MFC dialog box should 
                display the Windows Forms control.
              </p><div class="mediaCenter"><img alt="Resulting Application" src="../media/MFC06.png" /><div class="caption">Resulting Application</div></div></li></ol></div><div class="collapsibleAreaRegion" id="GenericApproach"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Generic Approach for MFC Dialogs and Views</span></div><div id="ID3RBSection" class="collapsibleSection"><p>
            The description in the last section just describes how to use the WinForms based map control in a MFC dialog. The 
            generic approach, using any WinForms controls in MFC dialogs a/o MFC views, is covered by great articles and samples 
            in the MSDN itself. Of course there are a lot of other online resources - a very good starting point is to query 
            the web for "C++/CLR MFC".
          </p><p>
            In the MSDN, the following articles may be very helpful:
          </p><ul><li><p><a href="http://msdn.microsoft.com/en-us/library/ahdd1h97.aspx" target="_blank">Using a Windows Form User Control in MFC (covers dialogs and views)</a></p></li><li><p><a href="http://msdn.microsoft.com/de-de/library/ms239718(v=vs.90).aspx" target="_blank">WinForms integration sample: Hosting a user control in a MFC application</a></p></li></ul></div></div></div><div id="pageFooter" class="pageFooter">Visit our website at <a href="http://www.ptvgroup.com">www.ptvgroup.com</a> or browse to <a href="http://xserver.ptvgroup.com">xserver.ptvgroup.com</a> for the latest information on our developer components.<p>Copyright (c) PTV Group, Karlsruhe, Germany.</p><div class="feedbackLink">Send comments on this topic to
        <a id="HT_MailLink" href="mailto:developer%40ptvgroup.com?Subject=PTV xServer .NET">developer@ptvgroup.com</a></div>
        <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>