<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Tour Planning</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="34f6b520-454f-4a6a-b0ae-00fc77da512b" /><meta name="Description" content="This page describes the Tour planning use case, which shows how to plan a tour containing depots, orders and an associated vehicle." /><meta name="Microsoft.Help.ContentType" content="Samples" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">PTV xServer .NET<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html\9e985ce7-8d43-434f-82bb-260b742553c1.htm" title="PTV xServer .NET" tocid="roottoc">PTV xServer .NET</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/a5bc5d46-5eb8-4b50-be53-1ffa3f7bc7f4.htm" title="How To ..." tocid="a5bc5d46-5eb8-4b50-be53-1ffa3f7bc7f4">How To ...</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/5ff21e55-6f37-451d-acae-9321ca31836d.htm" title="XServer Connection" tocid="5ff21e55-6f37-451d-acae-9321ca31836d">XServer Connection</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/714dc4ba-10d3-4a8d-a55d-6210630ff6eb.htm" title="Show Here Satellite View" tocid="714dc4ba-10d3-4a8d-a55d-6210630ff6eb">Show Here Satellite View</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/4926f311-8333-4b18-b509-70c1d876d5eb.htm" title="Show Clusters" tocid="4926f311-8333-4b18-b509-70c1d876d5eb">Show Clusters</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/101dba72-fb36-468b-aa99-4b9c5bbfb62f.htm" title="Add Different Shapes" tocid="101dba72-fb36-468b-aa99-4b9c5bbfb62f">Add Different Shapes</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/e9f559c7-394c-4858-8a40-4744d2fc7200.htm" title="Integrate an additional WPF map" tocid="e9f559c7-394c-4858-8a40-4744d2fc7200">Integrate an additional WPF map</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/6b437145-f3ed-4267-a3fc-e71737e6db65.htm" title="Add a GeoRSS Layer" tocid="6b437145-f3ed-4267-a3fc-e71737e6db65">Add a GeoRSS Layer</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/d705537f-f7fe-435c-bd80-d4d399ee4410.htm" title="Show Map&amp;Market Data" tocid="d705537f-f7fe-435c-bd80-d4d399ee4410">Show Map&amp;Market Data</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/427ab62e-f02d-4e92-9c26-31e0f89d49c5.htm" title="Show a Shape File Content" tocid="427ab62e-f02d-4e92-9c26-31e0f89d49c5">Show a Shape File Content</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/2f6d7ed1-b136-44dc-97c1-3f2c640c2134.htm" title="Add a WMS Layer" tocid="2f6d7ed1-b136-44dc-97c1-3f2c640c2134">Add a WMS Layer</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/fccd9937-aa04-4803-936d-7796cb966963.htm" title="Selection" tocid="fccd9937-aa04-4803-936d-7796cb966963">Selection</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/90fd0772-df3b-473b-a305-6ee939193c7f.htm" title="Apply a UI Theme" tocid="90fd0772-df3b-473b-a305-6ee939193c7f">Apply a UI Theme</a></div><div class="toclevel2" data-toclevel="2"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/fe48cb51-c6ce-487e-b4c0-168537c184c3.htm" title="Geocode an Address" tocid="fe48cb51-c6ce-487e-b4c0-168537c184c3">Geocode an Address</a></div><div class="toclevel2" data-toclevel="2"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/e7c12cc4-3819-470e-867a-b521bee43cf0.htm" title="Elementary Routing" tocid="e7c12cc4-3819-470e-867a-b521bee43cf0">Elementary Routing</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/e4c416a0-9573-4df8-b733-3bf72539ef0f.htm" title="Drag&amp;Drop Routing" tocid="e4c416a0-9573-4df8-b733-3bf72539ef0f">Drag&amp;Drop Routing</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="../html/34f6b520-454f-4a6a-b0ae-00fc77da512b.htm" title="Tour Planning" tocid="34f6b520-454f-4a6a-b0ae-00fc77da512b">Tour Planning</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/eb8e522c-5ed2-4481-820f-bfd74ee2aeb8.htm" title="Use the Map Gadgets" tocid="eb8e522c-5ed2-4481-820f-bfd74ee2aeb8">Use the Map Gadgets</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/fdaa5363-b092-43cc-950e-6f120dee0d92.htm" title="Set the Map Location" tocid="fdaa5363-b092-43cc-950e-6f120dee0d92">Set the Map Location</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/b55f5d50-a421-4951-bc01-d5fb85c94f54.htm" title="Add an XMapServer Layer" tocid="b55f5d50-a421-4951-bc01-d5fb85c94f54">Add an XMapServer Layer</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/91617b6b-1086-4c05-a1ce-4c64f8bc7dcd.htm" title="Add a Custom Layer" tocid="91617b6b-1086-4c05-a1ce-4c64f8bc7dcd">Add a Custom Layer</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/88521cb3-0770-4f9c-9e47-74b6ea02b6eb.htm" title="Build an ActiveX Control" tocid="88521cb3-0770-4f9c-9e47-74b6ea02b6eb">Build an ActiveX Control</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/1cdf95ec-699c-4d92-bc98-df93503e5a4e.htm" title="Build a C++/MFC application" tocid="1cdf95ec-699c-4d92-bc98-df93503e5a4e">Build a C++/MFC application</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>Tour Planning</h1></td></tr></table><span class="introStyle"></span> <div class="introduction"><p>
        This page describes the <span class="term">Tour planning</span> use case, which shows how to plan a tour containing
        depots, orders and an associated vehicle. Due to the commonly long duration of a tour planning, an asynchronous
        call of this functionality is shown, which keeps the user interface reactive. Especially the progress and status
        of the tour planning can be visualized on the user interface.
      </p><p>This page contains the following sections:</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#CreatingLayerInstances">Creating and configuring the different layer instances</a></li><li class="outlineSectionEntry"><a href="#SettingDifferentScenarios">Setting different scenarios</a></li><li class="outlineSectionEntry"><a href="#StartingTourPlanning">Starting the tour planning</a></li><li class="outlineSectionEntry"><a href="#UseCases">Use case manual</a></li></ul></div><div class="collapsibleAreaRegion" id="CreatingLayerInstances"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Creating and configuring the different layer instances</span></div><div id="ID1RBSection" class="collapsibleSection"><p>
          Logically, a
          <span class="nolink">Tour</span>
          consists of multiple
          <span class="nolink">Depot</span>s and
          <span class="nolink">Order</span>s, driven by an associated
          <span class="nolink">Vehicle</span>.
          All these geographical objects are organized in different
          <a href="T_Ptv_XServer_Controls_Map_Layers_Shapes_ShapeLayer.htm">ShapeLayer</a>s.
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAAAEAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAAAEAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAAAEAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAAAEAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">tourLayer = <span class="highlight-keyword">new</span> ShapeLayer(<span class="highlight-literal">"Tours"</span>);
wpfMap.Layers.InsertBefore(tourLayer, <span class="highlight-literal">"Labels"</span>); <span class="highlight-comment">// add before xmap labels</span>

orderLayer = <span class="highlight-keyword">new</span> ShapeLayer(<span class="highlight-literal">"Orders"</span>);
wpfMap.Layers.Add(orderLayer);

depotLayer = <span class="highlight-keyword">new</span> ShapeLayer(<span class="highlight-literal">"Depots"</span>);
wpfMap.Layers.Add(depotLayer);</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAAEAAA");</script></div><div class="collapsibleAreaRegion" id="SettingDifferentScenarios"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Setting different scenarios</span></div><div id="ID2RBSection" class="collapsibleSection"><p>
          According a predefined set of
          <span class="nolink">Scenario</span>s,
          the layers are configured, especially the amount of used objects differ.
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAAADAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAAADAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAAADAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAAADAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">tourLayer.Shapes.Clear();
orderLayer.Shapes.Clear();
depotLayer.Shapes.Clear();

<span class="highlight-keyword">foreach</span> (<span class="highlight-keyword">var</span> order <span class="highlight-keyword">in</span> scenario.Orders)
{
    <span class="highlight-keyword">var</span> pin = <span class="highlight-keyword">new</span> Cube { Color = unplannedColor };
    pin.Width = pin.Height = Math.Sqrt(order.Quantity) * <span class="highlight-number">10</span>;
    ShapeCanvas.SetLocation(pin, <span class="highlight-keyword">new</span> Point(order.Longitude, order.Latitude));
    orderLayer.Shapes.Add(pin);
    pin.Tag = order;
}

<span class="highlight-keyword">foreach</span> (<span class="highlight-keyword">var</span> depot <span class="highlight-keyword">in</span> scenario.Depots)
{
    <span class="highlight-keyword">var</span> pyramid = <span class="highlight-keyword">new</span> Pyramid();
    pyramid.Width = pyramid.Height = <span class="highlight-number">30</span>;
    pyramid.Color = depot.Color;
    ShapeCanvas.SetLocation(pyramid, <span class="highlight-keyword">new</span> Point(depot.Longitude, depot.Latitude));
    depotLayer.Shapes.Add(pyramid);
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAADAAA");</script></div><div class="collapsibleAreaRegion" id="StartingTourPlanning"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Starting the tour planning</span></div><div id="ID3RBSection" class="collapsibleSection"><p>
          By means of the helper class
          <span class="nolink">TourCalculationWrapper</span>, 
          which encapsulates the calling aspects of the <span class="term">PTV xTour Server</span>, the asynchronous call can
          be started.
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EACACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EACACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EACACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EACACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">tourCalculationWrapper = <span class="highlight-keyword">new</span> TourCalculationWrapper();
tourCalculationWrapper.Progress = () =&gt; SendProgressInfo(tourCalculationWrapper.ProgressMessage, tourCalculationWrapper.ProgressPercent);
tourCalculationWrapper.Finished = RenderPlannedTours;
tourCalculationWrapper.StartPlanScenario(scenario);</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EACACAAA");</script><p>
          Especially delegates for the progress- and finished-event can be specified, needed for updating the user interface
          for status quo of the tour planning, meanwhile the user can interact with the application as before.
        </p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAAACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAAACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAAACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAAACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">tourPlanningUseCase.Initialized = () =&gt;
{
    TourPlanningStart.IsEnabled = <span class="highlight-keyword">true</span>;
};

tourPlanningUseCase.Progress = (progressMessage, percent) =&gt;
{
    TourPlanningStatus.Content = progressMessage;
    TourPlanningProgressBar.Value = percent;
};

tourPlanningUseCase.Finished = () =&gt;
{
    TourPlanningStart.Content = <span class="highlight-literal">"Start planning"</span>;
    TourScenarioComboBox.IsEnabled = <span class="highlight-keyword">true</span>;
    TourPlanningStart.IsEnabled = <span class="highlight-keyword">true</span>;
};</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAACAAA");</script></div><div class="collapsibleAreaRegion" id="UseCases"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID4RB')" onkeypress="SectionExpandCollapse_CheckKey('ID4RB', event)" tabindex="0"><img id="ID4RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Use case manual</span></div><div id="ID4RBSection" class="collapsibleSection"><p>
          This section describes the <span class="term">Tour planning</span> use case in the PTV xServer .Net Demo Center.
        </p><h4 class="subHeading" id="UseCase1">How to define a scenario</h4><div class="subsection"><p>
              The <span class="term">Tour planning</span> use case shows how to calculate a tour, and render it on the map. 
              Starting the demo application, a tour can be defined by opening  the <span class="term">Tour planning</span> expander.
            </p><div class="mediaCenter"><img alt="Tour Planning" src="../media/TourPlanning.png" /><div class="caption">Tour planning use case</div></div><p>
              In the combobox of the <span class="term">Tour planning</span> expander, different scenarios can be selected. They 
              mainly differ in the <strong>amount</strong> of generated orders and depots, and can be addressed via the
              <span class="nolink">Scenario</span> class.
            </p></div><h4 class="subHeading" id="UseCase2">Start a tour planning</h4><div class="subsection"><p>
              After selecting a scenario, i.e. a concrete configuration of randomly generated orders and depots, the tour
              planning can be started by pressing <span class="term">Start planning</span> button. Due to its asynchronous call an
              updated drawing of the progress bar is possible. Additionally, updating texts concerning the status quo are shown,
              and the start button is labeled 'Cancel' during the calculation process. Naturally, this calculation can be stopped
              every time by the user.
            </p></div></div></div></div><div id="pageFooter" class="pageFooter">Visit our website at <a href="http://www.ptvgroup.com">www.ptvgroup.com</a> or browse to <a href="http://xserver.ptvgroup.com">xserver.ptvgroup.com</a> for the latest information on our developer components.<p>Copyright (c) PTV Group, Karlsruhe, Germany.</p><div class="feedbackLink">Send comments on this topic to
        <a id="HT_MailLink" href="mailto:developer%40ptvgroup.com?Subject=PTV xServer .NET">developer@ptvgroup.com</a></div>
        <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>